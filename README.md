<div align="center" style="vertical-align: center;">
  <img alt="ロゴ画像" src="https://raw.githubusercontent.com/ritsu2891/NewestFileCopyScript/master/md-img/icon.png" height="80px" />
  <h1>NewestFileCopyScript</h1>
  <h1>最新ファイルコピースクリプト</h1>
  <img alt="Python" src="https://raw.githubusercontent.com/ritsu2891/NewestFileCopyScript/master/md-img/Python.svg" height="80px" />
</div>

<br/>

![動作イメージ](https://raw.githubusercontent.com/ritsu2891/NewestFileCopyScript/master/md-img/inuse.gif)

## 概要
![処理の流れのイメージ](https://raw.githubusercontent.com/ritsu2891/NewestFileCopyScript/master/md-img/processflow.png)
フォルダやファイル名が日時の情報を含む特定の命名規則の時に、それらのフォルダやファイル名の日時から最新のものを選んでいき最新のものを特定のフォルダにコピーします。ファイルそのものの更新時刻ではなく、フォルダ・ファイル名から最新ファイルを決定するスクリプトです。

## 作成の背景
![デモの流れ](https://raw.githubusercontent.com/ritsu2891/NewestFileCopyScript/master/md-img/ourusage.png)
このスクリプトは研究室で研究成果を利用したデモを制作する際に、作成したものです。センサで取得した値を使って何かをするというデモが多いのですが、センサからのデータの取得はデータロガーというアナログ信号を取り込んで外部メディアにCSVファイルとして書き出す事ができる装置を用います。このデータロガーから外部メディア経由でPCに取り込んで解析などのデモを行うという流れです。この際に記録した最新のファイルを見つけてコピーを行うという事を手動で行っていたのですが、面倒ですし何よりデモの際にお客さんに待たせてしまうのはよくない、という事で自動化するスクリプトを組みました。研究室全体で似たようなデモが多かったので、このスクリプトを共有して研究室全体でデモの効率化を図りました。

## 利用
このリポジトリ内に含まれる `app.py` をダウンロードし、引数を与えて実行してください。一度実行すると終了するまで最新ファイルがないか継続的に監視・コピーします。

## 引数
---
`python app.py [監視対象フォルダ] [コピー先フォルダ] [ファイル名] [オプション]`

**[監視対象フォルダ] - コピーするファイルを見つけるフォルダ**

このフォルダ内のサブフォルダを順にたどっていき、最新のファイルを見つけます。このフォルダはスクリプト実行時に存在している必要はありません。また、実行の途中でフォルダがなくなった場合でもエラーは発生しません。例えば外部メディアのパスを指定しておき、このスクリプトを実行したまま外部メディアのマウント・アンマウントを行っても問題ありません。

**[コピー先フォルダ] - 見つけたファイルをコピーする宛先のフォルダ**

見つけた最新のファイルをここで指定したフォルダにコピーします。このフォルダに関してはスクリプト実行時に存在していないとエラーとなります。

**[ファイル名] - コピー先でのファイル名**

見つけた最新のファイルのファイル名はここで指定したファイル名に変更されます。

**[オプション]** *<省略可能>*

以下のオプション引数が使えますが、指定しなくても問題ありません。

|引数|内容|
|---|---|
|-h, --help|ヘルプ画面を表示します|
|-i `INTERVAL`, --interval `INTERVAL`|ファイル探索間隔を `INTERVAL` 秒に変更します。（デフォルト：3秒）|
|-d, --debug|デバッグメッセージを有効にします。|

---

## 日時命名規則の変更
`app.py` の128, 129行目の `pathFtm` および `dtFmt` が命名規則を定義している変数です。デフォルトでは以下のようになっています。

```python
pathFmt = ["^\d{2}-\d{2}-\d{2}", "^\d{2}_\d{2}_\d{2}", "^\d{6}-\d{6}"]
dtFmt = ["%y-%m-%d", "%H_%M_%S", "%y%m%d-%H%M%S"]
```

それぞれ配列になっていますが、引数で指定されたフォルダ（探索ルートフォルダ）からフォルダを探索していく際に配列の先頭の規則から順番に利用されます。また、この配列の最後の要素以外はフォルダの命名規則、最後の要素はファイルの命名規則として扱われます。探索ルートフォルダを `root` とすると、 `root/a/b/c.csv` に対して `root/a` には `pathFmt[0]`・`dtFmt[0]`、 `root/a/b` に対しては `pathFmt[1]`・`dtFmt[1]`、 `root/a/b/c.csv` に対しては`pathFmt[2]`・`dtFmt[2]` が用いられます。

`pathFmt` がフォルダ・ファイル名の命名規則を表す正規表現の配列です。これはフォルダ・ファイル探索時に候補となるフォルダ・ファイル名を絞り込むのに利用します。この命名規則を通過したら、次に日時情報の抽出を行います。

`dtFmt` が日時情報の命名規則を表す文字列の配列です。この命名規則は[こちら](https://docs.python.org/ja/3/library/datetime.html#strftime-and-strptime-format-codes)を参考にして指定してください。

## 動作環境
- Python 3.4以降（検証：3.8.2）
- OS: Windows / Mac / Linux（検証：Max OS X 10.15.5, Windows 10）

## 利用ライブラリ
- 標準ライブラリのみ